# Milestone 0.4 — UI 体验与基础交互全面升维

## 1. 目标

在前序完善基础功能与数据管理的基础上，解决用户高频操作中遇到的各种细节痛点。涵盖 Bug 精准消杀、原生组件替换、核心功能改进（包括有序主键、全局防抖）、并注入丝滑的动画体验与高级图表交互。

## 2. 需求详情及完成情况

### 2.1 第一阶段：高优先级 Bug 修复
| 状态 | 需求项            | 详情                                                                                                                         |
| ---- | ----------------- | ---------------------------------------------------------------------------------------------------------------------------- |
| ✅    | 下拉选择修复      | 修复首页“添加账户类型”及“记一笔分类”下拉组件失去响应的失效问题。                                                             |
| ✅    | 备注长度限制      | 限制最大录入 50 字符，超长时提供实时 UI 提示并在数据源拦截。                                                                 |
| ✅    | 彻底移除转账      | 梳理全局代码结构，彻底清理残留的转账 Enum 声明、数据类型校验、处理逻辑代码及 Markdown 相关引用。                             |
| ✅    | 修复导入 TXT 异常 | 排查并解决了 TXT 导入历史账单时错误随机生成“支付宝”、“现金”冗余账户的 Bug。                                                  |
| ✅    | 全局替换 alert    | 查找项目中所有原生丑陋的 `alert()` / `confirm()` 方法，并全量使用自定义弹窗及 Toast 组件替换以保持极佳的 UI 统一。           |
| ✅    | 英文提示本地化    | 对 Toast 的默认英文文案执行了全量本地汉化。                                                                                  |
| ✅    | TXT导入账户流闭环 | TXT 导入增加智能预检机制：如果无对应账户 -> 系统自动静默创建；如有存量账户 -> 弹出全局弹窗提示用户人工选择欲挂载的目标账户。 |
| ✅    | 统计时间选择器    | 提取维度判断，呈现差异化且互斥的选择组件：(按日→日历、按月→年月盘、按年→年份列表盘、按周→自动圈定周)。加大水平边距修复叠字。 |

### 2.2 第二阶段：核心功能改进
| 状态 | 需求项            | 详情                                                                                                                                                                                                                    |
| ---- | ----------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ✅    | 分类联想检索      | 添加分类处支持防抖(Debounce) 的拼音/中文输入，下方原有的折叠分类树会联动自动过滤展示并高亮匹配字符。                                                                                                                    |
| ✅    | UUID 序贯主键重构 | 采用零依赖的 `Date.now() + index` （如 `YYYYMMDDHHMMSSms_随机`）自研字符串，替代乱序的 `uuidv4`；不仅抹平依赖，更为历史 TXT 同分钟条目补齐顺序一致的主键；在导入前新增批量比对防重，弹窗交予用户选择保留/跳过，极稳固。 |

### 2.3 第三阶段：UI/UX 体验交互进阶
| 状态 | 需求项           | 详情                                                                                                                                    |
| ---- | ---------------- | --------------------------------------------------------------------------------------------------------------------------------------- |
| ✅    | Framer Tab 动画  | 为“记一笔”引入强大的 Framer Motion，利用 Shared Layout 打造点击后物理丝滑顺移的下划线切换交互。                                         |
| ✅    | 金额竖直高频排版 | 利用 Flex+Translate 补正金额款左侧的 ¥ 符号垂直死区。                                                                                   |
| ✅    | 饼图图表重载     | 修改 Recharts 的底层结构：尾部（<2.5%的偏门分类）自动聚合折叠为“其他”项；外挂联动鼠标 Hover 的发光放大高亮，抹除所有堆叠脏 Label 显示。 |

## 3. 技术决策 & 选型分析回溯

- **去依赖化思维持续深耕：**
  在主键序列化生成的时候坚决拥抱标准 API（放弃 `ulid` 包），不仅显著改善由于纯原生无序 UUID 所带来的 TXT 序列恢复倒错，也兼顾本地程序的独立运行性原则。
- **高级物理动画引入:**
  确认 Shadcn 无法在简单伪类下解决滑动跟手物理动画，直接拍板引入业界标准 `framer-motion` 作为此版及将来的核心级动效主力，快速通过 `layoutId` 实现优雅切换。

*完结时间：2026-02-21*
