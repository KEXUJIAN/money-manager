# Milestone v0.4.1 (Patch 1)

## 📌 目标
修复 Milestone 0.4 中遗留的“其他”分类合并冲突 BUG 与配色重复 BUG，并引入更为强大的 XLSX 报表原生导出功能。

## 📍 已完成任务

### 1. 修复统计图表“其他”项冲突问题 (Bugfix)
- **原因分析**：内置系统存在的收、支两个名为“其他”的项，遇到了 `CategoryBreakdown` 组件动态聚合（当占比<2.5%时）时硬编码命名为“其他”的逻辑。使得最后出现 React 的 Key 重叠，引发 hover 与点击状态混乱。
- **解决方案**：引入了隔离命名，将聚合项命名为 `其他聚合 (共X项)` 并在内部附带真实唯一 id 用作渲染 key。该项支持下钻展开查看被隐藏的散碎金额项，交互体验大幅上升。

### 2. 饼图色彩循环冲撞问题 (Bugfix)
- **原因分析**：硬编码了 10 个颜色，分类超出时按取余回绕生成，导致不同分类视觉无法区分。
- **解决方案**：移除了硬编码颜色组。采用基于黄金角度（Golden Angle 137.5°）递增的 HSL 色彩生成策略：`hsl((i * 137.5) % 360, 70%, 50%)`。确保无穷尽的分类也能展现出分化且视觉友好的配色序列。

### 3. 数据分析功能加强：导出 XLSX (Feature)
- **原因分析**：之前利用旧版 txt 或者基础 csv 导出含有数字的数据时，在本地 Excel 打开极易转为科学计数法，破坏账单金额。
- **解决方案**：彻底引入轻量而强大的社区版 `xlsx`，在本地直接在浏览器中构建内存级 Excel File，精准将金额定义为纯数值，名称/日期等定为文本类别，确保后续复杂的二次使用需求完美达成。

## 🛠 技术决策记录

- **引入第三方库**：`xlsx` (SheetJS)
  - _决策理由_：在分析导出的需求中，手写带 BOM 的 CSV 往往无法有效避免 Excel 的自动转码截断问题。而生成原生 XLSX 是根本解药。在可控依赖增加中能换取巨大的业务鲁棒性，合理。
- **UI 下钻**：
  - _决策理由_：没有选择引入额外的弹窗或是层叠饼图，为了遵循本应用 KISS (Keep It Simple, Stupid) 原则。在下方已有列表处支持内联展开就是最低认知负担且最容易实现的平替途径。

---
_完成时间：2026-02_
